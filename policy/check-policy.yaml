# gcloud beta container binauthz policy create check-based-policy-demo \
# --platform gke \
# --policy-file policy/check-policy.yaml

gkePolicy:
  imageAllowlist:
    allowPattern:
      - "us.gcr.io/google-containers/**"
      - "gcr.io/google_containers/**"
      - "gcr.io/stackdriver-agents/**"
      - "gke.gcr.io/**"

  checkSets:
    - displayName: "Demo check set"
      scope:
        kubernetesNamespace: "default"
      imageAllowlist:
        allowPattern:
          - "us-west1-docker.pkg.dev/cloudy-demos/*"
          - "us-docker.pkg.dev/cloudy-demos/*"
      checks:
        - vulnerabilityCheck:
           maximumFixableSeverity: LOW
           maximumUnfixableSeverity: MEDIUM
           allowedCves:
             - "CVE-2020-29511"
             - "CVE-2020-29509"
           containerAnalysisVulnerabilityProjects: "projects/goog-vulnz"
        - displayName: "Image freshness check"
          imageFreshnessCheck:
            maxUploadAgeDays: 30
        - alwaysDeny: true

    - displayName: "Default check set"
      checks:
        - alwaysDeny: true